{
  "openapi": "3.0.1",
  "info": {
    "version": "1.1.1",
    "title": "Water tracker",
    "description": "API documentation for project Water tracker.  \n\nЦей проект є веб-додатком для керування особистим споживанням води в межах добової норми, який дозволяє користувачам вести облік своїх порцій випитої води протягом дня. Головна мета проекту полягає в тому, щоб забезпечити користувачів інструментами для контролю кількості води в організмі, планування та відслідковування її споживань. \n\nУ проекті передбачено можливість реєстрації користувачів, їх аутентифікації та авторизації. Крім того, користувачі можуть створювати та відстежувати свої порції вживання води протягом дня, переглядати статистику за місяць, а також виконувати редагування та видалення своїх порцій. \n\nОкрім того, додаток має дружній та зрозумілий інтерфейс користувача, що дозволяє зручно та швидко виконувати всі необхідні дії. Проект також забезпечує безпеку користувачів за допомогою шифрування паролів та ідентифікації за допомогою токенів. \n\n**Функціональні можливості:** \n\nРеєстрація та авторизація користувачів \n\nДодавання, перегляд та видалення порцій випитої води \n\nВідображення детальної статистики за день. \n\nВідображення загальної статистики користувачів за місяць. \n\n**Стек технологій, що використовується у проекті:** \n\nNode.js - середовище виконання JavaScript на сервері \n\nExpress.js - фреймворк для розробки веб-додатків на Node.js \n\nMongoDB - NoSQL база даних \n\nMongoose - бібліотека для роботи з MongoDB у Node.js",
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "consumes": ["application/json", "multipart/form-data"],
  "produces": ["application/json"],
  "servers": [
    { "url": "https://water-tracker-backend.onrender.com" },
    { "url": "https:ocalhost:4000" }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Authorization endpoints"
    },
     {
      "name": "User",
      "description": "User profile endpoints"
    },
     {
      "name": "WaterRate",
      "description": "User water rate endpoints"
    },
     {
      "name": "Water inputs",
      "description": "Water inputs endpoints"
    }
  ],
  "paths": {
    "/api/auth/signup": {
      "post": {
        "tags": ["Auth"],
        "summary": "Sign up new user - User registration",
        "parameters": [],
        "requestBody": {
          "description": "Signup's object",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "New User Registered",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserInfoWithTokenSingupResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {}
          },
          "409": {
            "description": "Email in use",
            "content": {}
          }
        }
      }
    },
    "/api/auth/signin": {
      "post": {
        "tags": ["Auth"],
        "summary": "Sign in existing user",
        "parameters": [],
        "requestBody": {
          "description": "Signin's object",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sign in existing user",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserInfoWithTokenSinginResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {}
          },
          "401": {
            "description": "Email or password is wrong",
            "content": {}
          }
        }
      }
    },
    "/api/auth/logout": {
      "post": {
        "tags": ["Auth"],
        "summary": "User log out",
        "parameters": [],
        "security": [{ "Bearer": [] }],
        "responses": {
          "204": {
            "description": "User log out",
            "content": {}
          },
          "401": {
            "description": "Not authorized",
            "content": {}
          }
        }
      }
    },
    "/api/auth/reset-password": {
      "post": {
        "tags": ["Auth"],
        "summary": "Reset user's password",
        "parameters": [],
        "requestBody": {
          "description": "User's email",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthResetPasswordRequest"
              }
            }  
          }
        },
        "responses": {
          "200": {
            "description": "Success message",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResetPasswordResponse"
                }
              }  
            }  
          },
          "400": {
            "description": "Validation error",
            "content": {}
          },
          "404": {
            "description": "Email not found",
            "content": {}
          }
        }
      }
    },
    "/api/users/avatars": {
      "patch": {
        "tags": ["User"],
        "summary": "Change user's avatar",
        "parameters": [],
        "requestBody": {
          "description": "Upload file new user's avatar",
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema":{
                 "$ref": "#/components/schemas/UserChangeAvatarRequest"
              }
            }
          }
        },
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Avatar's URL",
            "content": {
              "application/json": {
                "schema":{
                  "$ref": "#/components/schemas/UserChangeAvatarResponse"
                }  
              }
            }
          },
          "400": {
            "description": "File not found, File extention not allow",
            "content": {}
          },
          "401": {
            "description": "Not authorized",
            "content": {}
          }
        }
      }
    },
    "/api/users/current": {
      "get": {
        "tags": ["User"],
        "summary": "Get current user info",
        "parameters": [],
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": " Logged user returned",
            "content": {
              "application/json": {
                "schema": { 
                  "$ref": "#/components/schemas/UserInfoResponse"
                }
              }
            }
          },
          "401": {
            "description": "Not authorized",
            "content": {}
          }
        }
      }
    },
    "/api/users/": {
      "patch": {
        "tags": ["User"],
        "summary": "Update user profile",
        "parameters": [],
        "requestBody": {
          "description": "Update user",
          "required": true,
          "content": {
            "application/json": {
              "schema":{
                "$ref": "#/components/schemas/UserChangeInfoRequest"
              }
            }
          }
        },
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Update user returned",
            "content": {
              "application/json": {
                "schema":{
                  "$ref": "#/components/schemas/UserChangeInfoResponse"
                }  
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {}
          },
          "401": {
            "description": "Not authorized, wrong old password",
            "content": {}
          }
        }
      }
    },
    "/api/waterRate/": {
      "patch": {
        "tags": ["WaterRate"],
        "summary": "Change user's water rate",
        "parameters": [],
        "requestBody": {
          "description": "New water rate",
          "required": true,
          "content": {
            "application/json": {
              "schema":{
                "$ref": "#/components/schemas/WaterRateRequest"
              }
            }
          }
        },
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "New water rate value",
            "content": {
              "application/json": {
                "schema":{
                  "$ref": "#/components/schemas/WaterRateResponse"
                }  
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {}
          },
          "401": {
            "description": "Not authorized",
            "content": {}
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AuthRequest": {
        "type": "object",
        "required": ["email", "password"],
        "properties": {
          "email": {
            "type": "string",
            "description": "User's email",
            "format": "email"
          },
          "password": {
            "type": "string",
            "description": "User's password",
            "example": "qwertY123!"
          }
        }
      },
      "AuthResetPasswordRequest": {
        "type": "object",
        "required": ["email"],
        "properties": {
          "email": {
            "type": "string",
            "description": "User's email",
            "format": "email"
          }
        }
      },
      "UserChangeAvatarRequest": {
        "type": "object",
        "required": ["avatar"],
        "properties": {
          "avatar": {
            "type": "string",
            "description": "File of avatar",
            "format":"binary"
          }
        }
      },
      "UserChangeInfoRequest": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "User's email",
            "format": "email"
          },
          "userName": {
            "type": "string",
            "description": "User's name",
            "example": "David"
          },
          "gender": {
            "type": "string",
            "description": "User's gender",
            "example": "male",
            "enum":[
              "male",
              "female"
            ]
          },
          "oldPassword": {
            "type": "string",
            "description": "Old user's password",
            "example": "qwertY123!"
          },
          "newPassword": {
            "type": "string",
            "description": "New user's password",
            "example": "qwertY123+"
          }
        }
      },
      "WaterRateRequest": {
        "type": "object",
        "required": ["waterRate"],
        "properties": {
          "waterRate": {
            "type": "integer",
            "description": "User's water rate",
            "example": "1500"
          }
        }
      },
      "UserInfoDefaultResponse": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "User's email",
            "format": "email"
          },
          "userName": {
            "type": "string",
            "description": "User's name",
            "example": ""
          },
          "avatarURL": {
            "type": "string",
            "description": "User's avatar",
            "example": ""
          },
          "gender": {
            "type": "string",
            "description": "User's gender",
            "example": "female",
             "enum":[
                      "male",
                     "female"
                    ]
          },
          "waterRate": {
            "type": "integer",
            "description": "User's daily water rate",
            "example": "2000"
          }
        }
      },
      "UserInfoResponse": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "User's email",
            "format": "email"
          },
          "userName": {
            "type": "string",
            "description": "User's name",
            "example": "David"
          },
          "avatarURL": {
            "type": "string",
            "description": "User's avatar",
            "example": "http://res.cloudinary.com/asdvsfs/image/upload/v1745783123/avatars/214d37639e15fd1ac2e9a53c_avatar.jpg"
          },
          "gender": {
            "type": "string",
            "description": "User's gender",
            "example": "male",
             "enum":[
                      "male",
                     "female"
                    ]
          },
          "waterRate": {
            "type": "integer",
            "description": "User's daily water rate",
            "example": "1500"
          }
        }
      },

      "UserInfoWithTokenSingupResponse": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string",
            "description": "Bearer token",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaWQiOiIyOWI4ZmZmNS0xN2NjLTQ5NTYtOTViZC1jN2U3N2FkZDEwOWEiLCJpYXQiOjE2ODE4OTM3MzEsImV4cCI6MTAwMDAwMDE2ODE4OTM3MzJ9.hQpNKIj4SR7Gm9waUMn7hzwKQyqwKrniL_qSW7SxrjM"
          },
          "user": {
            "$ref": "#/components/schemas/UserInfoDefaultResponse"
          }
        }
      },
       "UserInfoWithTokenSinginResponse": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string",
            "description": "Bearer token",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaWQiOiIyOWI4ZmZmNS0xN2NjLTQ5NTYtOTViZC1jN2U3N2FkZDEwOWEiLCJpYXQiOjE2ODE4OTM3MzEsImV4cCI6MTAwMDAwMDE2ODE4OTM3MzJ9.hQpNKIj4SR7Gm9waUMn7hzwKQyqwKrniL_qSW7SxrjM"
          },
          "user": {
            "$ref": "#/components/schemas/UserInfoResponse"
          }
        }
      },
      "AuthResetPasswordResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Success message",
            "example":"A new password has been sent to your email"
          }
        }
      },
      "UserChangeAvatarResponse": {
        "type": "object",
        "properties": {
          "avatarURL": {
            "type": "string",
            "description": "Avatar's URL",
            "example": "http://res.cloudinary.com/asdvsfs/image/upload/v1745783123/avatars/214d37639e15fd1ac2e9a53c_avatar.jpg"
          }
        }
      },
      "UserChangeInfoResponse": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "User's email",
            "format": "email"
          },
          "userName": {
            "type": "string",
            "description": "User's name",
            "example": "David"
          },
          "gender": {
            "type": "string",
            "description": "User's gender",
            "example": "male",
             "enum":[
                      "male",
                     "female"
                    ]
          }
        }
      },
      "WaterRateResponse": {
        "type": "object",
        "properties": {
          "waterRate": {
            "type": "integer",
            "description": "User's water rate",
            "example": "1500"
          }
        }
      },
      "GetAllWaterInputsResponse": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "_id": {
              "type": "string",
              "desctiption": "ID of water input records"
            },
            "waterVolume": {
              "type": "integer",
              "desctiption": "The portion of water consumed in a single entry."
            },
            "date": {
              "type": "string",
              "description": "Time of water intake."
            },
            "owner": {
              "type": "string",
              "description": "User's id"
            }
          }
        },
        "example": [
          {
            "_id": "65509fe5990eba42a7c84d80",
            "waterVolume": 50,
            "date": "2023-11-01T15:23:45.678Z",
            "owner": "654f6747c4faaae3bc1857f1"
          },
          {
            "_id": "6550a2c5990eba42a7c84d83",
            "waterVolume": 100,
            "date": "2023-10-01T15:23:45.678Z",
            "owner": "654f6747c4faaae3bc1857f1"
          }
        ]
      },
      "GetTotalWaterInputByCurrentDayResponse": {
        "type": "object",
        "properties": {
          "waterInputsForToday": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "_id": {
                  "type": "string",
                  "description": "ID of water input records"
                },
                "waterVolume": {
                  "type": "integer",
                  "description": "The portion of water consumed in a single entry."
                },
                "date": {
                  "type": "string",
                  "description": "Time of water intake."
                },
                "owner": {
                  "type": "string",
                  "description": "User's id"
                }
              }
            }
          },
          "dailyNormFulfillment": {
            "type": "integer",
            "description": "Total daily water consumption fulfillment."
          }
        },
        "example": {
          "waterInputsForToday": [
            {
              "_id": "6550bd6da31c7d1b6d55241a",
              "waterVolume": 1,
              "date": "2023-11-12T10:03:24.626Z",
              "owner": "654f6747c4faaae3bc1857f1"
            },
            {
              "_id": "6550bd80a31c7d1b6d55241d",
              "waterVolume": 2,
              "date": "2023-11-12T13:05:24.626Z",
              "owner": "654f6747c4faaae3bc1857f1"
            }
          ],
          "dailyNormFulfillment": 50
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
